<!DOCTYPE html>
<html lang="ko" xml:lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="soulGod/fragments/header"></th:block>
</head>
<script type="text/javascript">

    let areaNm;
    let schlNm;
    let grade;
    let ban;
    let values;
    let batchArr;
    let loginId;
    let pwd;
    var pwdChk;
    var idDupBool = false;
    let frm;
    let TeacherNm;

    function fn_chkField() {
        id = $('#id');
        loginId = $("#loginId");
        pwd = $("#pwd");
        pwdChk = $("#pwdChk");
        nm = $("#nm");
        mberDvTy = $("#mberDvTy");
        batchArr = $("#batchArr");
        values = $("#values");
        TeacherNm = $("#TeacherNm");

        /*if(values.val() == "" || values.val() == null){
            alert('선생님 정보를 입력하세요.')
            TeacherNm.focus()
            return false
        }*/


        if (batchArr.val() == "" || batchArr.val() == null) {
            alert('ID개수는 필수 값입니다.')
            batchArr.focus()
            return false
        }


        if(!idDupBool){
            alert("아이디 중복체크를 해주세요.");
            loginId.after('<p class="err emph">아이디 중복체크를 해주세요.</p>')
            loginId.focus();
            return false;
        }




        if (!$.trim(loginId.val())) {
            alert('아이디는 필수 값입니다.');
            loginId.focus();
            return false;
        } else {
            if (!loginIdCheck(loginId)) {
                return false;
            }
        }

        if(!fn_chkPwdDup()){
            return false;
        }
        return true;
    }


    function fn_chkPwdDup() {
        pwd = $("#pwd");
        pwdChk = $('#pwdChk');

        pwd.siblings('.err.emph').remove();
        if (!$.trim(pwd.val())) {
            alert('비밀번호는 필수 값입니다.');
            pwd.focus();
            return false;
        } else {
            if (!pwdCheck(pwd)) {
                pwd.val("");
                pwd.focus();
                return false;
            }
        }

        pwdChk.siblings('.err.emph').remove();
        if (!$.trim(pwdChk.val())) {
            alert('비밀번호 확인은 필수 값입니다.');
            pwdChk.focus();
            return false;
        } else {
            if (!pwdCheck(pwdChk)) {
                pwdChk.val("");
                pwdChk.focus();
                return false;
            }
        }

        if ($.trim(pwd.val()) != $.trim(pwdChk.val())) {
            alert('비밀번호가 일치하지 않습니다.');
            pwdChk.focus();
            return false;
        } else {

            return true;
        }
    }

    function fn_checkSpacebar() {
        var keyCode = event.keyCode;
        if (keyCode == 32) event.returnValue = false;
    }

    //선생 정보 조회
    function fn_srchTeacherNm() {
        TeacherNm = $('#TeacherNm');
        if (!$.trim(TeacherNm.val())) {
            alert('선생님 성함을 입력하세요');
            TeacherNm.focus();
            return false;
        }

        $.ajax({
            type: "post",
            url: "/test/soulGod/member/batchregister/srchTchrNm",
            dataType: "json",
            data: {
                "TeacherNm": TeacherNm.val()
            },
            success: function (data) {
                console.log(data);
                //alert(data[0].areaNm);
                var html = "";
                $('#TeacherNmList').empty();
                var scArr = '[[${memberSchoolList}]]';
                //var scArr = data.srchList[0].row;
                for (var i = 0; i < data.length; i++) {

                    var _areaNm = data[i].areaNm;
                    var _schlNm = data[i].schlNm;
                    var _teacherNm = data[i].teacherNm;
                    var _grade = data[i].grade;
                    var _ban = data[i].ban;


                    html += "   <input type=\"radio\" name=\"values\" id=\" values \" value=\" " + _areaNm + "," + _schlNm + "," + _teacherNm + "," + _grade + "," + _ban + " \">";
                    html += "   <label for=\"areaNm\" \"> (" + _areaNm + ")" + _schlNm + " " + _grade + "학년" + _ban + "반" + "</label>";

                }
                $('#values').hide();
                $('#TeacherNmList').append(html);
            },
            error: function (error) {
                alert(error.responseText);
                $('#TeacherNmList').append();
                $('#values').show();
            }
        });
    }
    //관리자
    function fn_chkIdDup(){
        loginId = $("#loginId");
        batchArr = $("#batchArr");
        loginId.siblings('.err.emph').remove();

        if(!$.trim(batchArr.val())) {
            alert('생성하실 계정의 개수를 먼저 입력 하세요.')
            batchArr.focus();
            return false;
        } else {

            if(!loginIdCheck(loginId)){
                return false;
            }

            $.ajax({
                type: "POST",
                url: "/test/api/member/isExistByBatchLoginId",
                data: {
                    "loginId": $.trim(loginId.val()),
                    "batchArr" : $.trim(batchArr.val())
                },
                success: function (data) {
                    if($.trim(loginId.val()) != ''){
                        alert('사용가능한 계정 양식 입니다.');
                        idDupBool = true;
                    }
                },
                error: function (error) {
                    alert(error.responseText);
                    idDupBool = false;
                    loginId.val('');
                    loginId.focus();
                }
            });
        }
    }

    function fn_comparePwd() {
        pwd = $("#pwd");
        pwdChk = $('#pwdChk');
        pwdChk.siblings('.err.emph').remove();
        if (pwd.val() != pwdChk.val()) {
            pwdChk.after('<p class="err emph">비밀번호가 일치하지 않습니다.</p>');
        }
    }

    //form prop
    $(document).ready(function (e) {
        frm = $('#form1');
        $('#btnSave').on('click', function (e) {
            $('#btnSave').prop('disalbed' , true)
            if(!fn_chkField(e)){
                $('#btnSave').prop('disabled' , false);
                return false;
            }

            frm.prop('action', '/test/soulGod/member/batchregister/join');
            frm.submit();
        });
    })


</script>


<body>

<div id="wrap">
    <th:block th:include="soulGod/fragments/menu"></th:block>
    <div id="container">
        <div class="container_box">

            <div class="contents">

                <ul class="breadcrumb">
                    <li><i class="material-icons">home</i></li>
                    <li>운영관리</li>
                    <li>회원 추가</li>
                </ul>

                <div class="board_detail clearfix">
                    <div class="sec">
                        <div class="board_top clearfix">
                            <div class="fl">
                                <h4 class="sec_tit">일괄가입</h4>
                            </div>
                        </div>
                        <div class="alert alert-warning alert-dismissible fade show" role="alert" th:if="${message}">
                            <strong><input type="text" th:field="${message}">message!</strong>
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <form id="form1" name="form1" modelAttribute="memberForm" method="post">
                            <input type="hidden" id="id" name="id"/>
                            <table class="tbl_write">
                                <colgroup>
                                    <col style="width:10%"/>
                                    <col style="width:auto"/>
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th scope="row"><label>선생님 조회<span class="aster">*</span></label></th>
                                    <td>
                                        <label for="TeacherNm" class="blind">이름 조회</label>
                                        <input type="text" id="TeacherNm" name="TeacherNm" class="w160" maxlength="12"/>

                                        <a href="javascript:;" class="btn btn_sm btn_line_blue btn_pill_10"
                                           onclick="return fn_srchTeacherNm()">조회</a>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row1">학교<label><span class="aster"></span></label></th>
                                    <td>
                                        <label for="loginId" class="blind">선생님 검색</label>
                                        <ul class="write_form">
                                            <li>
                                                <div class="td">
                                                    <div class="scrollbar">
                                                        <sapn id="values">조회된 정보가 없습니다.</sapn>
                                                        <div id="TeacherNmList">

                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row"><label>가입할 계정 개수<span class="aster">*</span></label></th>
                                    <td>
                                        <div class="td">
                                            <input type="number" id="batchArr" name="batchArr"
                                                   placeholder="일괄로 가입할 ID 개수 입력" onkeydown="fn_checkSpacebar();"/>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row"><label>계정 양식<span class="aster">*</span></label></th>
                                    <td>
                                        <label for="loginId" class="blind">로그인ID</label>
                                        <input type="text" id="loginId" name="loginId" class="w160" maxlength="12" placeholder="6~12자 영문 소문자, 숫자 사용" onkeydown="fn_checkSpacebar()"/>
                                        <a href="javascript:;" class="btn btn_sm btn_line_blue btn_pill_10" onclick="return fn_chkIdDup();">중복확인</a>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row"><label>비밀번호<span class="aster">*</span></label></th>
                                    <td>
                                        <div class="td">
                                            <input type="password" id="pwd" name="pwd" placeholder="8~16자(특수 문자 포함)"
                                                   onkeydown="fn_checkSpacebar()" onkeyup="fn_comparePwd()"/>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row"><label>비밀번호 확인<span class="aster">*</span></label></th>
                                    <td>
                                        <div class="td">
                                            <input type="password" name="pwdChk" id="pwdChk" placeholder="비밀번호 확인"
                                                   onkeydown="fn_checkSpacebar()" onkeyup="fn_comparePwd()"/>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </form>
                        <div class="btn_area">
                            <!--<button id="btnDelete" class="btn btn_sm btn_red" type="button">
                                <i class="material-icons">delete</i>삭제
                            </button>-->
                            <button id="btnSave" class="btn btn_sm btn_blue">
                                <i class="material-icons fz17">done</i>등록
                            </button>
                            <a class="btn btn_sm btn_lightgray" href="/soulGod/member/list">
                                <i class="material-icons">list</i>목록
                            </a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <th:block th:replace="soulGod/fragments/footer"></th:block>
</div>
</body>
</html>
